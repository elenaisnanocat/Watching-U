{% extends 'base.html' %}
{% block content %}




<div class="row">
<div class="col-md-12 text-center">
  <img style="border-radius: 50%" src={% if person.profile.image %}"{{ person.profile.image.url }}"{% endif %}"https://i.stack.imgur.com/34AD2.jpg" width=250 height=250>
  <h3>{{ person.username }}</h3>
  <p>{{ person.profile.description }}</p>
  {% if user == person %}
  <a href="{% url 'accounts:update' %}"><button type="button" class="btn btn-outline-secondary">프로필 수정</button></a>
  {% else %}
  <form id="follow-form" action="{% url 'accounts:follow' person.pk %}" method="POST">
    {% csrf_token %}
    {% if user in person.followers.all %}
      <button class="btn btn-outline-secondary">팔로우 취소</button>
    {% else %}
      <button>팔로우</button>
    {% endif %}
  </form>
  {% endif %}
</div>
</div>







<div class="text-center">
  <hr>
  reviews {{ person.review_set.all|length }} | 
  followings <span id="followings">{{ person.followings.all|length }}</span> | 
  followers <span id="followers">{{ person.followers.all|length }}</span> <br>
  영화 감상 <div class="badge text-wrap" style="width: 6rem; background-color: purple;">총 {{ user_runtime }}시간</div>
  <hr>
</div>









<div class="row text-center" style="margin: 0 auto">
  <ul class="col-4 list-group list-group-flush">
  <p class="mb-3 lead fw-bold">{{ person.username }}님의 게시글</p>
    {% for review in person.review_set.all %}
      <li class="list-group-item mx-5">
        <div><a style="color: black; text-decoration: none;" href="{% url 'community:detail' review.pk %}">{{ review.title }}</a></div>
      </li>
    {% endfor %}
  </ul> 
  <ul class="col-4 list-group list-group-flush">
    <p class="lead fw-bold">{{ person.username }}님의 댓글</p>
    {% for comment in person.comment_set.all %}
      <li class="list-group-item mx-5">
        <div><a style="color: black; text-decoration: none;" href="{% url 'community:detail' review.pk %}">{{ comment.content }}</div>
      </li>
    {% empty %}
      <li class="list-group-item mx-5">댓글이 아직 없어요.</li>
    {% endfor %}
  </ul>
  <ul class="col-4 list-group list-group-flush">
    <p class="lead fw-bold">{{ person.username }}님이 좋아한 리뷰</p>
    {% for review in person.like_reviews.all %}
      <li class="list-group-item mx-5">
        <div><a style="color: black; text-decoration: none;" href="{% url 'community:detail' review.pk %}">{{ review.title }}</div>
      </li>
    {% empty %}
    <li class="list-group-item mx-5">좋아요한 리뷰가 아직 없어요.</li>
    {% endfor %}
  </ul>
</div>


<div>
<p class="lead text-center fw-bold">{{ person.username }}님이 보고싶은 영화</p>
{% for movie in person.want_movies.all %}
  <a href="{% url 'movies:detail' movie.pk %}"><img src="{{ movie.poster_path }}" width="200px" height="300px"></a>
{% endfor %}
</div>


{% if user == person %}
<div class="text-center m-5">
<a href="{% url 'movies:recommend' %}">
<div class="badge text-wrap" style="width: 20rem; background-color: purple;">추천받으러 가기</div>
</a>
</div>
{% endif %}

{% endblock content %}


{% block script %}
<script>




const form = document.querySelector('#follow-form')
const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value

form.addEventListener('submit', (event) => {
  event.preventDefault()
  axios({
    method: 'POST',
    url: form.action,
    headers: {
      'X-CSRFToken': csrftoken
    }
  })
  .then(res => {
    const btn = form.querySelector('button')
    if (res.data.is_follow) {
      btn.innerText = '팔로우 취소'
    } else {
      btn.innerText = '팔로우'
    }

    const followers = document.querySelector('#followers')
    const followings = document.querySelector('#followings')

    followers.innerText = res.data.cnt_follower
    followings.innerText = res.data.cnt_following

  })
  .catch(err => {
    console.log(err)
  })

})


// chart
const ctx = document.getElementById('rankChart').getContext('2d');
console.log(data)
  const rankChart = new Chart(ctx, {
      type: 'line',
      data: {
          labels: ['d','d','d','d','d'],
          datasets: [{
              label: '# of Votes',
              data: [1,2,3,4,5],
              borderColor: [
                  'rgb(75, 192, 192)',
              ],
              fill: true,
              lineTension: 0.5
          }]
      },
  });




</script>
{% endblock script %}